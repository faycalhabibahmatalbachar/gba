<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test Structure Table Profiles</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Test Structure Table Profiles</h1>
    <div id="output"></div>

    <script>
        const SUPABASE_URL = 'https://vtyyjqirhqudxcmzvpkn.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ0eXlqcWlyaHF1ZHhjbXp2cGtuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ5MDQwODAsImV4cCI6MjA1MDQ4MDA4MH0.C5-TaVKtCM_ifFslR2K_0furB-263j7UuGY6QVH0Ays';
        
        const { createClient } = supabase;
        const client = createClient(SUPABASE_URL, SUPABASE_KEY);
        const output = document.getElementById('output');

        function log(message, isError = false) {
            const p = document.createElement('p');
            p.style.color = isError ? 'red' : 'black';
            p.textContent = message;
            output.appendChild(p);
            console.log(message);
        }

        async function testProfiles() {
            try {
                // 1. S'authentifier
                log('üîê Authentification...');
                const { data: authData, error: authError } = await client.auth.signInWithPassword({
                    email: 'habibahmat@gmail.com',
                    password: '77353230'
                });
                
                if (authError) {
                    log(`‚ùå Erreur auth: ${authError.message}`, true);
                    return;
                }
                
                log(`‚úÖ Connect√©: ${authData.user.id}`);

                // 2. Test direct avec select()
                log('\nüìä Test 1: Select simple...');
                const { data: data1, error: error1 } = await client
                    .from('profiles')
                    .select()
                    .eq('id', authData.user.id);
                
                if (error1) {
                    log(`‚ùå Erreur select: ${error1.message}`, true);
                } else {
                    log(`Type de r√©ponse: ${typeof data1}`);
                    log(`Donn√©es: ${JSON.stringify(data1, null, 2)}`);
                }

                // 3. Test avec maybeSingle()
                log('\nüìä Test 2: maybeSingle()...');
                const { data: data2, error: error2 } = await client
                    .from('profiles')
                    .select()
                    .eq('id', authData.user.id)
                    .maybeSingle();
                
                if (error2) {
                    log(`‚ùå Erreur maybeSingle: ${error2.message}`, true);
                } else {
                    log(`Type de r√©ponse: ${typeof data2}`);
                    log(`Donn√©es: ${JSON.stringify(data2, null, 2)}`);
                }

                // 4. Test avec single()
                log('\nüìä Test 3: single()...');
                const { data: data3, error: error3 } = await client
                    .from('profiles')
                    .select()
                    .eq('id', authData.user.id)
                    .single();
                
                if (error3) {
                    log(`‚ùå Erreur single: ${error3.message}`, true);
                } else {
                    log(`Type de r√©ponse: ${typeof data3}`);
                    log(`Donn√©es: ${JSON.stringify(data3, null, 2)}`);
                }

                // 5. V√©rifier la structure de la table
                log('\nüìã Test 4: Structure de la table...');
                const { data: allProfiles, error: allError } = await client
                    .from('profiles')
                    .select()
                    .limit(1);
                
                if (allError) {
                    log(`‚ùå Erreur structure: ${allError.message}`, true);
                } else {
                    log(`Exemple de profil:`);
                    log(JSON.stringify(allProfiles[0], null, 2));
                    if (allProfiles[0]) {
                        log(`\nColonnes disponibles: ${Object.keys(allProfiles[0]).join(', ')}`);
                    }
                }

            } catch (error) {
                log(`‚ùå Erreur g√©n√©rale: ${error.message}`, true);
            }
        }

        // Lancer le test
        testProfiles();
    </script>
</body>
</html>
